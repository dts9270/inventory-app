<!doctype html>
<html lang="mr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ЁЯУж рд╕рд╛рдорд╛рди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди (Full + Storage)</title>

<script src="https://cdn.tailwindcss.com"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- Excel -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
body{font-family:Inter,system-ui;background:#fff7ed}
.card{border-radius:12px;background:#fff;box-shadow:0 6px 15px rgba(0,0,0,0.1)}
</style>
</head>

<body class="p-4">
<div class="max-w-lg mx-auto">

<h1 class="text-center text-3xl font-bold text-amber-700 mb-4">ЁЯУж рд╕рд╛рдорд╛рди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди</h1>

<!-- Tabs -->
<div class="flex gap-2 mb-4">
<button id="tabIn" class="flex-1 p-3 bg-amber-600 text-white rounded">IN (рдШреЗрдгреЗ)</button>
<button id="tabOut" class="flex-1 p-3 bg-gray-300 rounded">OUT (рджреЗрдгреЗ)</button>
<button id="tabRep" class="flex-1 p-3 bg-gray-300 rounded">рд░рд┐рдкреЛрд░реНрдЯ</button>
</div>

<!-- IN Panel -->
<div id="panelIn" class="card p-4">
<h2 class="text-xl font-semibold mb-2">IN тАФ рд╕рд╛рдорд╛рди рдШреЗрддрд▓реЗ</h2>

<label>рддрд╛рд░реАрдЦ</label>
<input id="inDate" type="date" class="w-full p-2 border rounded mb-3">

<label>рдХреЛрдгрд╛рдХрдбреВрди</label>
<input id="inFrom" class="w-full p-2 border rounded mb-3" placeholder="рдкреБрд░рд╡рдард╛рджрд╛рд░">

<div class="grid grid-cols-2 gap-3">
<div>
<label>рдПрдХреВрдг тВ╣</label>
<input id="inTotal" type="number" class="w-full p-2 border rounded">
</div>
<div>
<label>рднрд░рд▓реЗ тВ╣</label>
<input id="inPaid" type="number" class="w-full p-2 border rounded">
</div>
</div>

<label class="mt-3">рдкреЗрдореЗрдВрдЯ рдкреНрд░рдХрд╛рд░</label>
<select id="inPayType" class="w-full p-2 border rounded mb-3">
<option>Cash</option><option>Online</option><option>Baki</option>
</select>

<label>рдлреЛрдЯреЛ/рдмрд┐рд▓</label>
<input id="inFile" type="file" class="w-full mb-3">

<button id="btnIn" class="w-full p-3 bg-amber-600 text-white rounded">IN Save</button>

<h3 class="text-lg mt-4 font-semibold">рддрд╛рдЬреНрдпрд╛ IN рдиреЛрдВрджреА</h3>
<div id="recentIn" class="text-sm mt-2"></div>
</div>

<!-- OUT Panel -->
<div id="panelOut" class="card p-4 hidden">
<h2 class="text-xl font-semibold mb-2">OUT тАФ рд╕рд╛рдорд╛рди рджрд┐рд▓реЗ</h2>

<label>рддрд╛рд░реАрдЦ</label>
<input id="outDate" type="date" class="w-full p-2 border rounded mb-3">

<label>рдХреЛрдгрд╛рд▓рд╛</label>
<input id="outTo" class="w-full p-2 border rounded mb-3" placeholder="рдЧреНрд░рд╛рд╣рдХ">

<div class="grid grid-cols-2 gap-3">
<div>
<label>рдПрдХреВрдг тВ╣</label>
<input id="outTotal" type="number" class="w-full p-2 border rounded">
</div>
<div>
<label>рднрд░рд▓реЗ тВ╣</label>
<input id="outPaid" type="number" class="w-full p-2 border rounded">
</div>
</div>

<label>рдкреЗрдореЗрдВрдЯ рдкреНрд░рдХрд╛рд░</label>
<select id="outPayType" class="w-full p-2 border rounded mb-3">
<option>Cash</option><option>Online</option><option>Baki</option>
</select>

<label>рдлреЛрдЯреЛ/рдмрд┐рд▓</label>
<input id="outFile" type="file" class="w-full mb-3">

<button id="btnOut" class="w-full p-3 bg-blue-600 text-white rounded">OUT Save</button>

<h3 class="text-lg mt-4 font-semibold">рддрд╛рдЬреНрдпрд╛ OUT рдиреЛрдВрджреА</h3>
<div id="recentOut" class="text-sm mt-2"></div>
</div>

<!-- REPORT Panel -->
<div id="panelRep" class="card p-4 hidden">
<h2 class="font-semibold text-xl mb-2">рд░рд┐рдкреЛрд░реНрдЯ</h2>
<button id="loadReport" class="w-full bg-green-600 p-3 text-white rounded">рд░рд┐рдкреЛрд░реНрдЯ рд▓реЛрдб рдХрд░рд╛</button>
<div id="reportOut" class="mt-4"></div>

<button id="pdfBtn" class="w-full bg-gray-700 text-white p-3 rounded mt-3">PDF</button>
<button id="excelBtn" class="w-full bg-green-700 text-white p-3 rounded mt-3">Excel</button>
</div>

<script>
// --- CONFIG ---
const firebaseConfig={
apiKey:"AIzaSyA3PdBavWlcE3w3QjgyOykv2jkAuFcUWbY",
authDomain:"product-buy-sell.firebaseapp.com",
projectId:"product-buy-sell",
storageBucket:"product-buy-sell.appspot.com"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();
const storage=firebase.storage();

function toast(t){alert(t);}

// --- Upload File ---
async function upload(file,folder){
if(!file) return "";
let path=`${folder}/${Date.now()}_${file.name}`;
let ref=storage.ref(path);
await ref.put(file);
return await ref.getDownloadURL();
}

// --- Save IN ---
btnIn.onclick=async()=>{
try{
const obj={
date:inDate.value,
from:inFrom.value,
total:Number(inTotal.value),
paid:Number(inPaid.value),
balance:Number(inTotal.value)-Number(inPaid.value),
payType:inPayType.value,
createdAt:Date.now()
};
obj.fileURL=await upload(inFile.files[0],"in");
await db.collection("in_entries").add(obj);
toast("IN Saved!");
load();
}catch(e){toast(e.message);}
};

// --- Save OUT ---
btnOut.onclick=async()=>{
try{
const obj={
date:outDate.value,
to:outTo.value,
total:Number(outTotal.value),
paid:Number(outPaid.value),
balance:Number(outTotal.value)-Number(outPaid.value),
payType:outPayType.value,
createdAt:Date.now()
};
obj.fileURL=await upload(outFile.files[0],"out");
await db.collection("out_entries").add(obj);
toast("OUT Saved!");
load();
}catch(e){toast(e.message);}
};

// --- Load Recent ---
async function load(){
let IN="",OUT="";
let snap=await db.collection("in_entries").orderBy("createdAt","desc").limit(5).get();
snap.forEach(d=>{let v=d.data();IN+=`<div class='p-2 border mb-1'>IN тВ╣${v.total} | ${v.from}</div>`});
recentIn.innerHTML=IN;

let s2=await db.collection("out_entries").orderBy("createdAt","desc").limit(5).get();
s2.forEach(d=>{let v=d.data();OUT+=`<div class='p-2 border mb-1'>OUT тВ╣${v.total} | ${v.to}</div>`});
recentOut.innerHTML=OUT;
}
load();

// --- Report ---
loadReport.onclick=async()=>{
let ins=await db.collection("in_entries").get();
let outs=await db.collection("out_entries").get();
let it=0,ip=0,ot=0,op=0;

ins.forEach(d=>{it+=d.data().total;ip+=d.data().paid});
outs.forEach(d=>{ot+=d.data().total;op+=d.data().paid});

reportOut.innerHTML=
`<div class='p-2 border mb-2'>IN Total тВ╣${it} | Paid тВ╣${ip} | Bal тВ╣${it-ip}</div>
 <div class='p-2 border'>OUT Total тВ╣${ot} | Paid тВ╣${op} | Bal тВ╣${ot-op}</div>`;
};

// --- Tabs ---
tabIn.onclick=()=>{panelIn.classList.remove("hidden");panelOut.classList.add("hidden");panelRep.classList.add("hidden");};
tabOut.onclick=()=>{panelOut.classList.remove("hidden");panelIn.classList.add("hidden");panelRep.classList.add("hidden");};
tabRep.onclick=()=>{panelRep.classList.remove("hidden");panelIn.classList.add("hidden");panelOut.classList.add("hidden");};
</script>

</div>
</body>
</html>
